<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Medieval Murder Mystery</title>
<style>
:root {
  --bg: #1f1b16;
  --panel: #2b241c;
  --panel-dark: #17130f;
  --accent: #4b3e30;
  --text: #f5e9d6;
}
* { box-sizing: border-box; }
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
}
h1 { font-size: 1.25rem; }
h2 { font-size: 1.1rem; }
h3 { font-size: 0.95rem; }
.container {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0.75rem;
}
.panel {
  background: var(--panel);
  border-radius: 12px;
  padding: 0.75rem;
  box-shadow: 0 0 10px rgba(0,0,0,0.4);
}
select, button {
  width: 100%;
  padding: 0.75rem;
  margin-top: 0.5rem;
  background: var(--accent);
  color: var(--text);
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  touch-action: manipulation;
}
button:active { transform: scale(0.98); }
.stats {
  display: grid;
  grid-template-columns: 1fr auto;
  row-gap: 0.25rem;
  font-size: 0.9rem;
}
.items > div {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-bottom: 0.25rem;
}
.items button { width: 42px; padding: 0.5rem; font-size: 1.1rem; }
.log {
  height: 200px;
  overflow-y: auto;
  background: var(--panel-dark);
  padding: 0.5rem;
  border-radius: 8px;
  font-size: 0.8rem;
}
.log div { margin-bottom: 0.25rem; }
.success { color: #4caf50; font-weight: 600; }
.fail { color: #e53935; font-weight: 600; }
@media (min-width: 768px) { .container { flex-direction: row; align-items: flex-start; } .panel { flex: 1; } .panel:first-child { max-width: 320px; } }
.cooldown { margin-top: 0.5rem; font-size: 0.9rem; font-weight: 600; }
.tooltip-btn { background: var(--accent); border-radius: 50%; width: 22px; height: 22px; font-size: 14px; padding:0; line-height:22px; text-align:center; margin-left:5px; }
</style>
</head>
<body>
<h1 style="padding:0.75rem">üó°Ô∏è Medieval Murder Mystery</h1>
<div class="container">
  <div class="panel">
    <h2>Character</h2>
    <select id="characterSelect"></select>

    <h3>Stats <button class="tooltip-btn" onclick="alert(statTooltipText)">?</button></h3>
    <div class="stats" id="stats"></div>

    <h3>Adjust Stats</h3>
    <div class="items" id="items"></div>
  </div>

  <div class="panel">
    <h2>Interaction</h2>
    <select id="npcSelect"></select>
    <div class="cooldown" id="cooldownDisplay">Select NPC to see cooldown</div>

    <h3>Action</h3>
    <button id="charmBtn" onclick="interact('charm')">Charm</button>
    <button id="stealBtn" onclick="interact('steal')">Steal</button>
    <button id="attackBtn" onclick="interact('attack')">Attack</button>

    <h3>Attack Type</h3>
    <select id="attackType">
      <option value="melee">Melee</option>
      <option value="ranged">Ranged</option>
      <option value="magic">Magic</option>
    </select>

    <h3>Event Log</h3>
    <div class="log" id="log"></div>
  </div>
</div>

<script>
const statDescriptions = {
  str: 'Strength: Determines melee attack power',
  dex: 'Dexterity: Determines ranged attack power and ability to steal',
  con: 'Constitution: Decreases cooldown period',
  int: 'Intelligence: Determines magic attack power',
  luck: 'Luck: Allows rolling multiple dice',
  cha: 'Charisma: Determines ability to charm NPCs'
};
const statTooltipText = Object.entries(statDescriptions).map(([k,v]) => `${k.toUpperCase()}: ${v}`).join('\n');

function setCookie(name,value,days=7){const expires=new Date(Date.now()+days*864e5).toUTCString();document.cookie=`${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`}
function getCookie(name){return document.cookie.split('; ').reduce((r,v)=>{const parts=v.split('=');return parts[0]===name?decodeURIComponent(parts[1]):r},null)}
const npcs={
  "Crow":{str:0,dex:5,con:0,int:7,luck:9,cha:0},
  "First Princess":{str:2,dex:4,con:0,int:5,luck:3,cha:7},
  "Fortune Teller":{str:0,dex:0,con:0,int:0,luck:6,cha:3},
  "Guard 1":{str:5,dex:3,con:0,int:3,luck:0,cha:0},
  "Guard 2":{str:2,dex:2,con:0,int:2,luck:0,cha:2},
  "Jester":{str:0,dex:0,con:0,int:6,luck:3,cha:5},
  "Queen":{str:7,dex:7,con:0,int:7,luck:0,cha:7},
  "Royal Dog":{str:3,dex:2,con:0,int:3,luck:3,cha:3},
  "Second Princess":{str:3,dex:4,con:0,int:4,luck:3,cha:4},
  "Street Cat":{str:1,dex:5,con:0,int:5,luck:7,cha:3},
  "Town Begger - Sir Saint Duggery":{str:4,dex:4,con:0,int:4,luck:0,cha:0},
  "Town Folk 1 - Jack":{str:1,dex:1,con:0,int:1,luck:0,cha:1},
  "Town Folk 2 - Jill":{str:0,dex:1,con:0,int:0,luck:0,cha:3},
  "Town Folk 3 - James":{str:2,dex:1,con:0,int:0,luck:9,cha:1},
};
const characters={
  "Bella - Bobert Bouzqueeffious":{str:0,dex:0,con:0,int:3,luck:0,cha:2},
  "Caleb - Aonn Rivers":{str:0,dex:0,con:0,int:3,luck:2,cha:0},
  "Cindy - Noctyra Hexwrn":{str:0,dex:0,con:0,int:2,luck:0,cha:3},
  "Dylan - Merlin":{str:0,dex:0,con:0,int:5,luck:0,cha:0},
  "Hannah - Dewalt The Dragon":{str:3,dex:1,con:0,int:1,luck:0,cha:0},
  "Kenzie - Ingrid Stormcloak":{str:1,dex:4,con:0,int:0,luck:0,cha:0},
  "Leti - Mistress Belladonna":{str:0,dex:0,con:0,int:1,luck:0,cha:4},
  "Lor√©l - Chromie":{str:3,dex:0,con:0,int:1,luck:0,cha:1},
  "Madeline - Algea":{str:0,dex:0,con:2,int:0,luck:3,cha:0},
  "Madi - Trinket Brassfield":{str:0,dex:3,con:0,int:3,luck:0,cha:-1},
  "Philip - Holark":{str:4,dex:0,con:2,int:2,luck:0,cha:-3},
  "Robert - Rian Josling":{str:0,dex:2,con:1,int:1,luck:3,cha:-2},
  "Rose - Aster Rhys":{str:0,dex:0,con:1,int:3,luck:2,cha:-1},
  "Stephen - Merrick":{str:2,dex:0,con:0,int:0,luck:0,cha:3},
  "Tristan - Bongo":{str:0,dex:2,con:1,int:0,luck:0,cha:2},
  "Tyler - Aldrich Blackthorn":{str:2,dex:0,con:1,int:2,luck:0,cha:0},
};

let currentCharacter=null;let currentCharacterName=null;
const charSelect=document.getElementById('characterSelect');
const npcSelect=document.getElementById('npcSelect');
const statsDiv=document.getElementById('stats');
const itemsDiv=document.getElementById('items');
const logDiv=document.getElementById('log');
const cooldownDisplay=document.getElementById('cooldownDisplay');
const charmBtn=document.getElementById('charmBtn');
const stealBtn=document.getElementById('stealBtn');
const attackBtn=document.getElementById('attackBtn');
Object.keys(characters).forEach(c=>charSelect.add(new Option(c,c)));
Object.keys(npcs).forEach(n=>npcSelect.add(new Option(n,n)));
npcSelect.add(new Option('Another Player','Another Player'));

function loadCharacterFromCookie(){const savedName=getCookie('mm_character_name');const savedStats=getCookie('mm_character_stats');if(savedName&&savedStats&&characters[savedName]){currentCharacterName=savedName;currentCharacter=JSON.parse(savedStats);charSelect.value=savedName;log('Loaded saved character')}else{currentCharacterName=charSelect.value;currentCharacter=JSON.parse(JSON.stringify(characters[currentCharacterName]))}}
function saveCharacterToCookie(){setCookie('mm_character_name',currentCharacterName);setCookie('mm_character_stats',JSON.stringify(currentCharacter))}
charSelect.onchange=()=>{currentCharacterName=charSelect.value;currentCharacter=JSON.parse(JSON.stringify(characters[currentCharacterName]));saveCharacterToCookie();renderStats();renderItems();updateCooldownDisplay()};
loadCharacterFromCookie();renderStats();renderItems();

function renderStats(){statsDiv.innerHTML='';Object.keys(currentCharacter).forEach(stat=>{const base=characters[currentCharacterName][stat]||0;const bonus=currentCharacter[stat]-base;const row=document.createElement('div');row.innerHTML=`<div>${stat.toUpperCase()}</div><div>${base}${bonus!==0?(bonus>0?' + '+bonus:' - '+Math.abs(bonus)):''}</div>`;statsDiv.appendChild(row)})}

function renderItems(){itemsDiv.innerHTML='';Object.keys(currentCharacter).forEach(stat=>{const row=document.createElement('div');const label=document.createElement('span');label.textContent=stat.toUpperCase();label.style.flex='1';const minus=document.createElement('button');minus.textContent='‚àí';minus.onclick=()=>adjustStat(stat,-1);const plus=document.createElement('button');plus.textContent='+';plus.onclick=()=>adjustStat(stat,1);row.append(label,minus,plus);itemsDiv.appendChild(row)})}

function adjustStat(stat,delta){currentCharacter[stat]+=delta;saveCharacterToCookie();renderStats();updateCooldownDisplay()}
function getCooldownMs(){return Math.max(0,3*60*1000-(currentCharacter.con||0)*15000)}
function getNpcCooldownKey(npc){return`mm_cd_${currentCharacterName}_${npc}`}function isOnCooldown(npc){const until=Number(getCookie(getNpcCooldownKey(npc)));return until&&Date.now()<until}
function setCooldown(npc){setCookie(getNpcCooldownKey(npc),Date.now()+getCooldownMs())}
function rollDice(stat,statsObj=null){statsObj=statsObj||currentCharacter;const rolls=1+Math.floor((statsObj.luck||0)/3);let best=0;for(let i=0;i<rolls;i++){best=Math.max(best,Math.floor(Math.random()*20)+1)}return best+(statsObj[stat]||0)}
function log(msg){const div=document.createElement('div');div.innerHTML=msg;logDiv.prepend(div)}
function updateCooldownDisplay(){const npc=npcSelect.value;if(npc==='Another Player'){cooldownDisplay.textContent='';enableButtons(true);return}const until=Number(getCookie(getNpcCooldownKey(npc)))||0;const remaining=until-Date.now();if(remaining>0){const sec=Math.ceil(remaining/1000);cooldownDisplay.textContent=`Cooldown: ${sec}s`;enableButtons(false)}else{cooldownDisplay.textContent='Ready';enableButtons(true)}}
function enableButtons(enabled){charmBtn.disabled=!enabled;stealBtn.disabled=!enabled;attackBtn.disabled=!enabled}
npcSelect.onchange=updateCooldownDisplay;setInterval(updateCooldownDisplay,500);

function interact(type){
  const target=npcSelect.value;
  if(target!=='Another Player'&&isOnCooldown(target)){log(`<span class="fail">${target} is on cooldown ‚è≥</span>`);return}

  let statUsed='cha';
  if(type==='steal') statUsed='dex';
  if(type==='attack'){
    const atk=document.getElementById('attackType').value;
    statUsed=atk==='melee'?'str':atk==='ranged'?'dex':'int';
  }

  const playerRoll=rollDice(statUsed);
  const atkType = type==='attack'?document.getElementById('attackType').value.toUpperCase():type.toUpperCase();

  if(target==='Another Player'){
    log(`PVP ${type.toUpperCase()} [${atkType}]: Roll = ${playerRoll} üé≤`);
    return;
  }

  const npc=npcs[target];
  const npcRoll=rollDice(statUsed,npc);
  const success=playerRoll>npcRoll;

  setCooldown(target);
  updateCooldownDisplay();

  const outcomeText=success?`<span class="success">SUCCESS üéâ</span>`:`<span class="fail">FAIL ‚ùå</span>`;
  log(`${type.toUpperCase()} vs ${target}${type==='attack'?` [${atkType}]`:''}: ${playerRoll} vs ${npcRoll} ‚Üí ${outcomeText}`);
}
</script>
</body>
</html>


